name: Test Sync with Artifactory

on:
  push:
    branches:
      - master  # Change this to your main branch

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up JFrog CLI
      run: |
        curl -fL https://getcli.jfrog.io | sh
        chmod +x jfrog
        sudo mv jfrog /usr/local/bin/
        jfrog --version

    - name: Zip the repo
      run: zip -r art_repo.zip .

    - name: Upload to Artifactory
      run: |
        jfrog rt u art_repo.zip "/test/" --url="https://artifactory.utc.com/ui/repos/tree/General/ccoe-usp-ccoe-iac-templates-generic-test-l" --apikey="${{ secrets.ARTIFACTORY_API_KEY }}"
      env:
        ARTIFACTORY_API_KEY: ${{ secrets.ARTIFACTORY_API_KEY }}
